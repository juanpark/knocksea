<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>게시글 상세</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        background-color: #f4f6f8;
      }

      .navbar {
        background-color: #2196f3;
        padding: 15px 30px;
        color: white;
        font-size: 24px;
        font-weight: bold;
      }

      .container {
        max-width: 800px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .status-badge {
        border-radius: 40px;
        padding: 0.6rem 0.7rem;
        color: white;
        margin-right: 1rem;
        font-weight: bold;
      }

      .status-waiting {
        background-color: #909090;
      }
      .status-completed {
        background-color: #2196f3;
      }
      .status-adopted {
        background-color: #1c9f3f;
      }

      .title {
        flex: auto;
        font-size: 2rem;
        font-weight: 600;
      }

      .category {
        color: #757474;
      }

      .post-meta {
        display: flex;
        justify-content: flex-end;
        color: #afadad;
      }

      .tag {
        display: inline-block;
        border: 2px solid #74bef8;
        border-radius: 40px;
        padding: 0.35rem 1rem;
        color: #288ad8;
        font-size: 0.8rem;
        margin-right: 0.5rem;
        margin-bottom: 1rem;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .btn {
        padding: 10px 15px;
        border: none;
        border-radius: 4px;
        background-color: #2196f3;
        color: white;
        cursor: pointer;
        text-decoration: none;
        font-weight: bold;
        transition: background-color 0.2s;
      }

      .btn:hover {
        background-color: #1976d2;
      }

      .btn-delete {
        background-color: #f44336;
      }

      .btn-delete:hover {
        background-color: #e53935;
      }

      .back-link {
        display: inline-block;
        margin-top: 20px;
        color: #2196f3;
        text-decoration: none;
        font-weight: bold;
      }

      .back-link:hover {
        text-decoration: underline;
      }

      .comment-header {
        display: flex;
        align-items: center;
        margin-top: 2rem;
      }

      .comment-check {
        background-color: #1c9f3f;
        border-radius: 50%;
        padding: 0 0.5rem;
        color: white;
        font-size: 1.3rem;
        margin-right: 0.5rem;
      }

      .comment-meta {
        color: #6c6666;
        font-size: 0.7rem;
        margin-left: 1rem;
      }

      .comment-content {
        margin-top: 0.5rem;
        font-size: 1.2rem;
      }

      .comment-form {
        display: flex;
        margin-top: 3rem;
        align-items: center;
      }

      .comment-form textarea {
        background-color: #d1d1d1;
        border-radius: 10px;
        border: none;
        width: 90%;
        height: 120px;
        resize: vertical;
      }

      .comment-submit {
        margin-left: 1rem;
      }
    </style>
  </head>

  <body>
    <div class="navbar">knocksea</div>

    <div class="container">
      <!-- 게시글 헤더 -->
      <div style="display: flex; align-items: center">
        <div
          th:class="'status-badge ' +
                      (${post.status} == 'WAITING' ? 'status-waiting' :
                       (${post.status} == 'COMPLETED' ? 'status-completed' : 'status-adopted'))"
          th:text="${post.status} == 'WAITING' ? '대기' :
                       (${post.status} == 'COMPLETED' ? '완료' : '채택')"
        >
          상태
        </div>
        <div class="title" th:text="${post.title}">게시글 제목</div>
        <div
          class="category"
          th:each="category : ${post.categoryNames}"
          th:text="${category}"
        >
          카테고리
        </div>
      </div>

      <hr />

      <div class="post-meta">
        조회수: <span th:text="${post.viewCount}">0</span>
      </div>

      <p th:text="${post.content}">게시글 내용</p>

      <!-- 태그 목록 -->
      <div>
        <span
          class="tag"
          th:each="tag : ${post.tagNames}"
          th:text="${tag}"
          >태그명</span
        >
      </div>

      <!-- 버튼 그룹 -->
      <div class="button-group">
        <a th:href="@{/posts/{id}/edit(id=${post.postsId})}" class="btn"
          >수정하기</a
        >
        <a
          href="#"
          class="btn btn-delete"
          th:onclick="'if(confirm(\'글을 삭제하시겠습니까?\')) { document.getElementById(\'deleteForm\').submit(); } return false;'"
        >
          삭제하기
        </a>
        <form
          id="deleteForm"
          th:action="@{/posts/{id}/delete(id=${post.postsId})}"
          method="post"
          style="display: none"
        ></form>
      </div>

      <a th:href="@{/posts/page}" class="back-link">← 목록으로</a>

      <!-- 댓글 목록 -->
      <div th:each="comment : ${comments}">
        <div class="comment-header">
          <div class="comment-check">✓</div>
          <div th:text="${comment.member}">작성자</div>
          <div
            class="comment-meta"
            th:text="${#temporals.format(comment.createAt, 'yyyy-MM-dd HH:mm')}"
          >
            날짜
          </div>
        </div>
        <div class="comment-content" th:text="${comment.content}">
          댓글 내용
        </div>

        <!-- 게시글 작성자일 경우 채택 버튼 표시 -->
        <div th:if="${isAuthor} and ${post.status} == 'COMPLETED'">
          <form
            th:action="@{/api/comments/{commentId}/adopt}"
            method="post"
            style="margin-top: 0.5rem"
          >
            <button type="submit" class="btn">이 댓글 채택하기</button>
          </form>
        </div>
      </div>

      <!-- 댓글 작성 폼 -->
      <div class="comment-form">
        <form
          th:action="@{/api/comments}"
          method="post"
          style="display: flex; width: 100%"
        >
          <textarea
            name="content"
            placeholder="댓글을 입력하세요..."
          ></textarea>
          <div class="comment-submit">
            <button type="submit" class="btn" style="border-radius: 10px">
              작성
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
